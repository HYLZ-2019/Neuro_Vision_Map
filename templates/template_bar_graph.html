<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Neuromorphic Vision Papers Timeline - Bar Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" type="text/css" href="../bar_style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">Neuromorphic Vision Research Timeline</div>
            <div class="subtitle">Publications by Conference/Journal Over Time (Stacked by Year)</div>
        </div>

        <div class="controls">
            <div class="control-section settings-controls">
                <h3>ðŸ“… Year Range</h3>
                <div class="year-selector" style="display: flex; gap: 15px; align-items: center;">
                    <label style="font-weight: 500;">From: <select id="startYear" onchange="updateChart()" style="padding: 5px; border-radius: 4px; border: 1px solid #ddd; margin-left: 5px;"></select></label>
                    <label style="font-weight: 500;">To: <select id="endYear" onchange="updateChart()" style="padding: 5px; border-radius: 4px; border: 1px solid #ddd; margin-left: 5px;"></select></label>
                </div>

                <div class="color-theme-section">
                    <h4>ðŸŽ¨ Color Theme</h4>
                    <div class="theme-selector">
                        <select id="colorTheme" onchange="changeColorTheme()">
                            <option value="vibrant" selected>Vibrant Rainbow</option>
                            <option value="professional">Professional Business</option>
                            <option value="pastel">Soft Pastel</option>
                            <option value="dark">Dark Tech</option>
                            <option value="nature">Fresh Nature</option>
                            <option value="sunset">Warm Sunset</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="control-section conference-controls">
                <h3>ðŸ“Š Conference/Journal Selection</h3>
                <div class="checkbox-grid" id="conferenceCheckboxes">
                    <!-- Checkboxes will be dynamically generated here -->
                </div>
            </div>

            <div class="control-section quick-actions">
                <h3>âš¡ Quick Actions</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="selectTop10()">Top 10 Conferences</button>
                    <button class="btn btn-secondary" onclick="selectAll()">Select All</button>
                    <button class="btn btn-secondary" onclick="selectNone()">Deselect All</button>
                    <button class="btn btn-secondary" onclick="selectMajorConferences()">Major CV Conferences</button>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>Loading chart data...</div>
            </div>
            <canvas id="paperChart" style="display: none;"></canvas>
        </div>

        <div class="stats" id="statsContainer">
            <!-- Statistics will be dynamically generated here -->
        </div>
    </div>

    <script>
        // Global variables
        let paperInfoList = [[INJECT_PAPER_INFO_LIST_HERE]];
        let chart = null;
        let conferenceColors = {};
        let conferenceData = {};

        // Conference color palettes - multiple themes
        const colorPalettes = {
            vibrant: [
                '#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', 
                '#e67e22', '#1abc9c', '#34495e', '#e91e63', '#ff6b6b',
                '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3',
                '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43', '#a55eea',
                '#26de81', '#fc5c65', '#fd79a8', '#fdcb6e', '#6c5ce7'
            ],
            professional: [
                '#2c3e50', '#34495e', '#7f8c8d', '#95a5a6', '#bdc3c7',
                '#3498db', '#2980b9', '#5dade2', '#85c1e9', '#aed6f1',
                '#e74c3c', '#c0392b', '#ec7063', '#f1948a', '#f5b7b1',
                '#f39c12', '#e67e22', '#f8c471', '#fad7a0', '#fdeaa7',
                '#27ae60', '#229954', '#58d68d', '#82e0aa', '#a9dfbf'
            ],
            pastel: [
                '#ffb3ba', '#ffdfba', '#ffffba', '#baffc9', '#bae1ff',
                '#d4a4eb', '#ffc09f', '#fcf5c7', '#aecf9e', '#b4c7e7',
                '#f8cecc', '#ffe599', '#d5e8d4', '#cfe2f3', '#e1d5e7',
                '#fdd5d7', '#fff2cc', '#d0e0e3', '#f3e2f3', '#e6f3ff',
                '#ffeaa7', '#fab1a0', '#fd79a8', '#a29bfe', '#6c5ce7'
            ],
            dark: [
                '#2d3436', '#636e72', '#b2bec3', '#ddd', '#0984e3',
                '#74b9ff', '#00b894', '#00cec9', '#e17055', '#fdcb6e',
                '#e84393', '#fd79a8', '#6c5ce7', '#a29bfe', '#55a3ff',
                '#26de81', '#fd79a8', '#fdcb6e', '#e17055', '#74b9ff',
                '#0984e3', '#00cec9', '#00b894', '#e84393', '#6c5ce7'
            ],
            nature: [
                '#27ae60', '#2ecc71', '#58d68d', '#82e0aa', '#a9dfbf',
                '#f39c12', '#f1c40f', '#f7dc6f', '#f9e79f', '#fcf3cf',
                '#8b4513', '#a0522d', '#cd853f', '#daa520', '#f4a460',
                '#2980b9', '#3498db', '#5dade2', '#85c1e9', '#aed6f1',
                '#c0392b', '#e74c3c', '#ec7063', '#f1948a', '#f5b7b1'
            ],
            sunset: [
                '#ff7675', '#fd79a8', '#fdcb6e', '#e17055', '#d63031',
                '#e84393', '#a29bfe', '#6c5ce7', '#74b9ff', '#0984e3',
                '#00cec9', '#00b894', '#55a3ff', '#2d3436', '#636e72',
                '#fab1a0', '#ff7675', '#fd79a8', '#fdcb6e', '#e17055',
                '#00b894', '#00cec9', '#74b9ff', '#6c5ce7', '#a29bfe'
            ]
        };

        let currentColorPalette = colorPalettes.vibrant;
        let minDataYear = 2010;
        let maxDataYear = 2025;

        // Process data and initialize
        function initializeChart() {
            document.getElementById('loading').classList.add('show');
            document.getElementById('paperChart').style.display = 'none';

            // Process paper data
            processData();
            
            // Create conference checkboxes
            createConferenceCheckboxes();
            
            // Initialize chart
            setTimeout(() => {
                createChart();
                updateStats();
                document.getElementById('loading').classList.remove('show');
                document.getElementById('paperChart').style.display = 'block';
            }, 500);
        }

        function populateYearSelects() {
            const startSelect = document.getElementById('startYear');
            const endSelect = document.getElementById('endYear');
            
            startSelect.innerHTML = '';
            endSelect.innerHTML = '';
            
            for (let y = minDataYear; y <= maxDataYear; y++) {
                const opt1 = document.createElement('option');
                opt1.value = y;
                opt1.textContent = y;
                startSelect.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = y;
                opt2.textContent = y;
                endSelect.appendChild(opt2);
            }
            
            // Set defaults
            startSelect.value = minDataYear;
            endSelect.value = maxDataYear;
        }

        function processData() {
            conferenceData = {};
            const conferenceCount = {};
            
            // Reset min/max
            minDataYear = 9999;
            maxDataYear = 0;

            // Count papers per conference and year
            paperInfoList.forEach(paper => {
                const [title, year, source, institutes] = paper;
                const yearNum = parseInt(year);
                
                if (isNaN(yearNum) || yearNum < 1900 || yearNum > 2100) return;

                // Update min/max
                minDataYear = Math.min(minDataYear, yearNum);
                maxDataYear = Math.max(maxDataYear, yearNum);

                if (!conferenceData[source]) {
                    conferenceData[source] = {};
                    conferenceCount[source] = 0;
                }
                
                if (!conferenceData[source][yearNum]) {
                    conferenceData[source][yearNum] = 0;
                }
                
                conferenceData[source][yearNum]++;
                conferenceCount[source]++;
            });
            
            // Populate year selects
            populateYearSelects();

            // Sort conferences by total paper count
            const sortedConferences = Object.entries(conferenceCount)
                .sort(([,a], [,b]) => b - a)
                .map(([conf,]) => conf);

            // Assign colors
            sortedConferences.forEach((conf, index) => {
                conferenceColors[conf] = currentColorPalette[index % currentColorPalette.length];
            });

            // Keep data as yearly counts (not cumulative)
            // Data is already in the correct format for stacked bar chart
        }

        function createConferenceCheckboxes() {
            const container = document.getElementById('conferenceCheckboxes');
            const conferences = Object.keys(conferenceData)
                .sort((a, b) => {
                    const countA = Math.max(...Object.values(conferenceData[a] || {}));
                    const countB = Math.max(...Object.values(conferenceData[b] || {}));
                    return countB - countA;
                });

            conferences.forEach((conf, index) => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `conf_${conf}`;
                checkbox.value = conf;
                checkbox.checked = index < 10; // Default: top 10
                checkbox.addEventListener('change', updateChart);

                const label = document.createElement('label');
                label.htmlFor = `conf_${conf}`;
                label.textContent = conf;
                label.style.color = conferenceColors[conf];

                div.appendChild(checkbox);
                div.appendChild(label);
                container.appendChild(div);
            });
        }

        function createChart() {
            const ctx = document.getElementById('paperChart').getContext('2d');
            
            // Get all years from min to max
            const allYears = [];
            for (let year = minDataYear; year <= maxDataYear; year++) {
                allYears.push(year);
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: allYears,
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Neuromorphic Vision Papers by Conference/Journal (Stacked by Year)',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                boxHeight: 12,
                                padding: 8,
                                font: {
                                    size: 10
                                },
                                usePointStyle: true,
                                pointStyle: 'rect'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255,255,255,0.2)',
                            borderWidth: 1,
                            callbacks: {
                                title: function(context) {
                                    return `Year: ${context[0].label}`;
                                },
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y} papers`;
                                },
                                afterBody: function(context) {
                                    const total = context.reduce((sum, item) => sum + item.parsed.y, 0);
                                    return `Total in ${context[0].label}: ${total} papers`;
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Year',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            },
                            categoryPercentage: 0.8,
                            barPercentage: 0.9
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Number of Papers',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            updateChart();
        }

        function updateChart() {
            if (!chart) return;

            const selectedConferences = Array.from(document.querySelectorAll('#conferenceCheckboxes input[type="checkbox"]:checked'))
                .map(cb => cb.value);

            // Get selected years
            let startYear = parseInt(document.getElementById('startYear').value);
            let endYear = parseInt(document.getElementById('endYear').value);
            
            if (startYear > endYear) {
                // Swap if inverted
                [startYear, endYear] = [endYear, startYear];
                document.getElementById('startYear').value = startYear;
                document.getElementById('endYear').value = endYear;
            }

            const allYears = [];
            for (let year = startYear; year <= endYear; year++) {
                allYears.push(year);
            }
            
            // Update chart labels
            chart.data.labels = allYears;

            const datasets = selectedConferences.map(conf => {
                const data = allYears.map(year => {
                    return conferenceData[conf] && conferenceData[conf][year] ? conferenceData[conf][year] : 0;
                });

                return {
                    label: conf,
                    data: data,
                    backgroundColor: conferenceColors[conf],
                    borderWidth: 0,
                    borderRadius: 0,
                    borderSkipped: false,
                };
            });

            chart.data.datasets = datasets;
            chart.update();
            updateStats();
        }

        function updateStats() {
            const selectedConferences = Array.from(document.querySelectorAll('#conferenceCheckboxes input[type="checkbox"]:checked'))
                .map(cb => cb.value);

            // Get selected years
            let startYear = parseInt(document.getElementById('startYear').value);
            let endYear = parseInt(document.getElementById('endYear').value);
            
            if (startYear > endYear) {
                [startYear, endYear] = [endYear, startYear];
            }

            let totalPapers = 0;
            let totalConferences = selectedConferences.length;
            let latestYear = 0;
            let earliestYear = 9999;

            // Calculate total papers across all selected conferences and years
            selectedConferences.forEach(conf => {
                if (conferenceData[conf]) {
                    const years = Object.keys(conferenceData[conf]).map(y => parseInt(y));
                    
                    // Filter years based on selection
                    const validYears = years.filter(y => y >= startYear && y <= endYear);
                    
                    validYears.forEach(y => {
                        totalPapers += conferenceData[conf][y];
                    });
                    
                    if (validYears.length > 0) {
                        latestYear = Math.max(latestYear, Math.max(...validYears));
                        earliestYear = Math.min(earliestYear, Math.min(...validYears));
                    }
                }
            });

            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value" style="color: #e74c3c;">${totalPapers}</div>
                    <div class="stat-label">Total Papers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #3498db;">${totalConferences}</div>
                    <div class="stat-label">Selected Venues</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #2ecc71;">${earliestYear === 9999 ? 'N/A' : earliestYear}</div>
                    <div class="stat-label">First Year</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" style="color: #f39c12;">${latestYear === 0 ? 'N/A' : latestYear}</div>
                    <div class="stat-label">Latest Year</div>
                </div>
            `;
        }

        // Control functions
        function selectTop10() {
            const checkboxes = document.querySelectorAll('#conferenceCheckboxes input[type="checkbox"]');
            checkboxes.forEach((cb, index) => {
                cb.checked = index < 10;
            });
            updateChart();
        }

        function selectAll() {
            const checkboxes = document.querySelectorAll('#conferenceCheckboxes input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            updateChart();
        }

        function selectNone() {
            const checkboxes = document.querySelectorAll('#conferenceCheckboxes input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            updateChart();
        }

        function selectMajorConferences() {
            const majorConfs = ['CVPR', 'ICCV', 'ECCV', 'AAAI', 'ICML', 'NeurIPS', 'IJCAI'];
            const checkboxes = document.querySelectorAll('#conferenceCheckboxes input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = majorConfs.includes(cb.value);
            });
            updateChart();
        }

        function changeColorTheme() {
            const themeSelect = document.getElementById('colorTheme');
            const selectedTheme = themeSelect.value;
            currentColorPalette = colorPalettes[selectedTheme];
            
            // Update conference colors with new palette
            const conferences = Object.keys(conferenceData);
            conferences.forEach((conf, index) => {
                conferenceColors[conf] = currentColorPalette[index % currentColorPalette.length];
            });
            
            // Update chart with new colors
            updateChart();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeChart);
    </script>
</body>
</html>